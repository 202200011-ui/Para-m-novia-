<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Carta Animada</title>
<style>
  body {
    margin: 0;
    background-color: black;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
  }
  #sobre-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 10;
    cursor: pointer;
  }
  #sobre {
    font-size: 200px;
    transition: all 0.7s ease;
  }
  #abreme {
    color: black;
    font-size: 40px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }
  #hoja {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 80%;
    max-width: 500px;
    padding: 30px;
    background-color: white;
    color: black;
    font-size: 20px;
    border-radius: 10px;
    box-shadow: 0 0 15px yellow;
    text-align: center;
    line-height: 1.5;
    z-index: 9;
    transition: all 1s ease;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<audio id="musica">
  <source src="flores_amarillas.mp3" type="audio/mp3">
  Tu navegador no soporta el elemento de audio.
</audio>

<canvas id="flores"></canvas>

<div id="sobre-container">
  <div id="sobre">游눏</div>
  <div id="abreme">츼breme</div>
</div>

<div id="hoja"></div>

<script>
const canvas = document.getElementById('flores');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const musica = document.getElementById('musica');

// Clase Flor
class Flor {
  constructor(yInicial= Math.random() * canvas.height) {
    this.x = Math.random() * canvas.width;
    this.y = yInicial;
    this.size = Math.random() * 15 + 15;
    this.speedY = Math.random() * 1 + 0.5;
    this.alpha = Math.random() * 0.5 + 0.5;
    this.alphaDir = Math.random() > 0.5 ? 0.01 : -0.01;
    this.flashTimer = Math.random() * 200 + 100;
  }
  draw() {
    for (let i = 0; i < 5; i++) {
      let angle = (i * 2 * Math.PI) / 5;
      let petalX = this.x + Math.cos(angle) * this.size;
      let petalY = this.y + Math.sin(angle) * this.size;
      ctx.beginPath();
      ctx.arc(petalX, petalY, this.size / 2, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,255,0,${this.alpha})`;
      ctx.fill();
    }
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size / 2, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,165,0,${this.alpha})`;
    ctx.fill();
  }
  update() {
    this.y += this.speedY;
    if (this.y > canvas.height + this.size) {
      this.y = -this.size;
      this.x = Math.random() * canvas.width;
    }
    this.alpha += this.alphaDir;
    if (this.alpha >= 1 || this.alpha <= 0.3) this.alphaDir *= -1;
    this.flashTimer--;
    if (this.flashTimer <= 0) {
      this.alpha = 1;
      this.flashTimer = Math.random() * 200 + 100;
    }
    this.draw();
  }
}

// Clase Coraz칩n
class Corazon {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = Math.random() * 15 + 10;
    this.speedY = Math.random() * 1 + 0.5;
    this.alpha = Math.random() * 0.5 + 0.5;
    this.alphaDir = Math.random() > 0.5 ? 0.01 : -0.01;
    this.flashTimer = Math.random() * 200 + 100;
  }
  draw() {
    ctx.fillStyle = `rgba(255,255,0,${this.alpha})`;
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.bezierCurveTo(this.x, this.y - this.size / 2, this.x - this.size, this.y - this.size / 2, this.x - this.size, this.y + 0);
    ctx.bezierCurveTo(this.x - this.size, this.y + this.size / 2, this.x, this.y + this.size / 1.2, this.x, this.y + this.size);
    ctx.bezierCurveTo(this.x, this.y + this.size / 1.2, this.x + this.size, this.y + this.size / 2, this.x + this.size, this.y + 0);
    ctx.bezierCurveTo(this.x + this.size, this.y - this.size / 2, this.x, this.y - this.size / 2, this.x, this.y);
    ctx.fill();
    ctx.fillStyle = `rgba(255,255,0,${this.alpha})`;
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Te amo', this.x, this.y - this.size - 5);
  }
  update() {
    this.y += this.speedY;
    if (this.y > canvas.height + this.size) {
      this.y = -this.size;
      this.x = Math.random() * canvas.width;
    }
    this.alpha += this.alphaDir;
    if (this.alpha >= 1 || this.alpha <= 0.3) this.alphaDir *= -1;
    this.flashTimer--;
    if (this.flashTimer <= 0) {
      this.alpha = 1;
      this.flashTimer = Math.random() * 200 + 100;
    }
    this.draw();
  }
}

const flores = [];
for (let i = 0; i < 50; i++) flores.push(new Flor());

const corazones = [];
for (let i = 0; i < 30; i++) corazones.push(new Corazon());

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  flores.forEach(flor => flor.update());
  corazones.forEach(cor => cor.update());
  requestAnimationFrame(animate);
}
animate();

// Animaci칩n del sobre y carta
const sobre = document.getElementById('sobre');
const hoja = document.getElementById('hoja');

const poema = `Aunque la distancia nos separe, cada flor amarilla lleva un pedacito de mi coraz칩n, cada p칠talo susurra tu nombre, cada color recuerda tu sonrisa, y aunque no pueda tocarte hoy, mi amor viaja en cada flor, record치ndote que siempre te pienso y que eres lo m치s bonito que me ha pasado 游눝`;

sobre.addEventListener('click', () => {
  sobre.style.transform = 'scale(0.8) rotateX(180deg)';
  sobre.style.opacity = '0';
  document.getElementById('abreme').style.opacity = '0';

  // Reproducir m칰sica al abrir
  musica.play().catch(()=>{});

  // Flores tipo ramo subiendo desde abajo
  for (let i = 0; i < 30; i++) {
    let flor = new Flor(canvas.height + Math.random() * 50);
    flor.speedY = -(Math.random() * 2 + 1.5); // suben hacia arriba
    flores.push(flor);
  }

  setTimeout(() => {
    hoja.style.transform = 'translate(-50%, -50%) scale(1)';
    escribirPoema(poema, hoja);
  }, 700);
});

function escribirPoema(texto, elemento) {
  let i = 0;
  elemento.textContent = '';
  let interval = setInterval(() => {
    elemento.textContent += texto[i];
    i++;
    if (i >= texto.length) clearInterval(interval);
  }, 40);
}
</script>
</body>
</html>